15/10/05:
    ZAPI: when we use { native }, it means in ZAPI the input will be given as a String instead of the type by which the field is declared.

    mgwd_byname - A command given on the CLI "cifs session show -node node1" can be given from any node in the cluster.
    By making the table distributed, we can give commands that should be performned in a remote mgwd (i.e. in a different node)


    mgwd_process - This is a dummy table. We might be using this to fake it as a dsmf table.

15/10/01:
    Praveen:
        Only RDB table needs replication. Normal tables don't need replication as the other node will be passive.
        In a MCC setup, if replication is enabled, the table will be replicated to the partner nodes.

15/09/24:
    Raghav:
    Functions like isMatchingClientForEnum, we don't need to take a Lock on the Sessions in SessionCloseTask::run() because, we will be running in the 
    network context in which we have to close the session.

    We have to be in the network context to close the session.

    But in ResumelistCase, We will be in any nextwork context.
    if we don't take the resume list lock, all we have is a Session Pointer by the time we try to access it again, some one could have deleted 
    it by coming to our network context.

    It is important to know if we are in the right network context to close a session.

    SMB Encryption:
        What will happen if you change SMB encryption setting when traffic is in progress. 

15/09/03:
    Praveen: Hammer burt
    CSM layer will send back pressure to Dblade.
    if there are more than certain requests from Nblade then we will suspend.

    If Q0S is enabled, then it acts as if a filter is in place. We can set up QoS in such a way to throttle over certain requests. So this will put a 
    backpressure on Dblade. 

    Nblade will suspend in this case. So the suspension count will be really high.


015/08/06:
    ResumeLists:
        ResumeListEntry is nothing but a Session object itself.
        ResumeHandle is a pointer that Points to ResumePoint so that we can start from the ResumePoint instead of going over from the front of the list.


2015/07/31:
Garrett's HyperV over SMB techtalk
Witness
    Monitor for LIF or other node failure. So once there is a failure, we can have an immediate take over.

Remote VSS
    Better version of VSS (Snapshot copy).

ODX - Offloaded Data Transfer (Copy Offload)
    If copy is between nodes, we can optimize that by doing a back end copy instead of going through the client. 
    

2015/07/08:
    Praveen: Burt 898726 Cifs Share permission to be effective immediately.
    When someone changes the permission of a share, we know the SHARE_NAME. 
    Nblade replay will happen. And we can get the share_object and share_id by looking up the corresponding table.

    Then we will create a multi-context task, that goes over all the trees and checks who all have connected to that share_id.
    If any tree is connected to that share_id, we change the permission of the share in that tree to NEW_ONE.

    PREEMPTIVE:
        If there are a large number of trees, then we don't want to be cpu intensive. We should give back the cpu every
        once in a while. So we kept a number 8192 where after processing 8192 trees, we return a retriable error, so that
        we give back the CPU and do our processing after few seconds.
    
2015/06/19:
    SWBUILD:
        Has metadata workload
    VDI:
        Use some videos. So it has large read/write workload

2015/06/18:
    Resume Lists:
        When sending out RPC, once we get a response (say we got 20 session to be displayed), after displaying we should continue 
        from WHERE WE LEFT OFF instead of starting all the way from top

   MQE tasks:
        MQE task creates unit of work in a NetworkContext

2015/06/04:
    Praveen:
    	Some information related to who can access the file are stored in Dblade, files inode.
	Also in Dblade everything is stored in UNIX style as it is possible to convert a volume from windows style to unix style


2015/05/28:
    Whenever we get OUT_OF_MEMORY error, an ems event would be thrown. That means CIFS does not have enough memory to perform the operations

2015/05/18:
    File Storage and Block Level Storage


2015/05/13:
Praveen:
	Symlink:
pragadhe-vsim1% ls -l
total 12
drwxrwxrwx  2 root  wheel  4096 May 13 12:07 .snapshot
drwxrwxrwx  2 root  wheel  4096 May 13 17:19 1
-rwxrwxrwx  1 root  wheel    12 May 13 13:39 a.txt
lrwxr-xr-x  1 root  wheel     7 May 13 17:19 sym1 -> 1/1.txt
drwxrwxrwx  2 root  wheel  4096 May 13 13:39 vol5

pragadhe-vsim1% ln -s /abc/ asym1
pragadhe-vsim1% ls -l
total 12
drwxrwxrwx  2 root  wheel  4096 May 13 12:07 .snapshot
drwxrwxrwx  2 root  wheel  4096 May 13 17:19 1
-rwxrwxrwx  1 root  wheel    12 May 13 13:39 a.txt
lrwxr-xr-x  1 root  wheel     5 May 13 17:29 asym1 -> /abc/
lrwxr-xr-x  1 root  wheel     7 May 13 17:19 sym1 -> 1/1.txt
drwxrwxrwx  2 root  wheel  4096 May 13 13:39 vol5
		
pragadhe-clus-1::> cifs symlink create -unix-path /abc/ -share-name sh1 -cifs-path /1/1.txt/ -cifs-server PRAGCS1 -locality local -home-directory false

c$ IS A HIDDEN SHARE AS IT ENDS WITH $. SO WIDELINK DOES NOT WORK WELL
pragadhe-clus-1::> cifs symlink modify -unix-path /abc/ -share-name c$

pragadhe-clus-1::> cifs symlink show
Vserver    Unix Path       CIFS Server     CIFS Share  CIFS Path      Locality
---------- --------------- --------------- ----------- -------------- --------
pragvs1    /abc/           PRAGCS1         c$          /1/1.txt/      local

pragadhe-clus-1::> cifs symlink modify -unix-path /abc/ -locality widelink -cifs-path /1/

pragadhe-clus-1::> cifs symlink show
Vserver    Unix Path       CIFS Server     CIFS Share  CIFS Path      Locality
---------- --------------- --------------- ----------- -------------- --------
pragvs1    /abc/           PRAGCS1         c$          /1/            widelink


pragadhe-clus-1::> cifs share create -share-name sh2 -path / -share-properties oplocks,browsable,changenotify -symlink-properties enable -offline-files manual

pragadhe-clus-1::> cifs symlink modify -unix-path /abc/ -share-name sh2

pragadhe-clus-1::> cifs symlink show
Vserver    Unix Path       CIFS Server     CIFS Share  CIFS Path      Locality
---------- --------------- --------------- ----------- -------------- --------
pragvs1    /abc/           PRAGCS1         sh2         /1/            widelink


WIDELINK:
When trying to access wide links, the first request gets PATH_NOT_COVERED error. After that we will send a DFS request. In the DFS response, we will get to know the actual share where the Wide Link is. 
Then client will send the create request with the actual share.

In Wide links, doing a DIR ASYM1\ is different from DIR ASYM1

The trailing \ matters. Check Jim's burt 889195


2015/05/05:
Raghav: 
About getting CIFSGLOBALS_LOCK_SCOPE_FOR_READ before reading some Vserver Config


        VserverConfigState (belongs to some hashd table)
        |
        |
        |
    VserverRuntime
    |
    |
Connection  

VserverConfigState won't go away until we have atleast one Connection. Once we get a ReadLock, it will make sure that the connection does not go away

mount | grep subin
10.56.10.108\home6\subin

p/d Hex number in gdb gives decimal number


2015/04/30:
How to grep through sktlogs.

When trying to find the right log that has around the time of failure HEAD through all the logs.

When checking EMS, try to display BEFORE AND AFTER lines

check commandhistory, lifmgr, vldb, messages, secd logs



2015/04/23:
Praveen:
    domain-discovered-servers-reset:
        Will remove servers from the BLACKLIST. so "cifs domain discovered-servers show" will be showing as UNDETERMINED

    cifs password reset:
        will reset the ticket that is valid for 10hrs. Till then, we will be reusing the existing ticket

LDAP:

TLS is another style of security used for communication with DC



2015/04/14:
    We should always use CHECK_RESULT to compare the result codes.
    There is an higher order bit that is set which will enable/disabling logging.

57#define RESULT_ERROR_NO_LOG     0x80000000
58#define RESULT_CODE(err) ((err) & ~RESULT_ERROR_NO_LOG)
59#define CHECK_PASS(err) (RESULT_CODE((err)) == RESULT_SUCCESS)
60#define CHECK_FAIL(err) (!CHECK_PASS(err))
61#define CHECK_RESULT(err1, err2) (RESULT_CODE((err1)) == RESULT_CODE((err2)))
    
    The following is wrong
    _resBuf.error == RESULT_ERROR_SECD_NO_SERVER_AVAILABLE 
    ChkBoolAssert(Result != RESULT_ERROR_NGPROCESS_RETRY);

2015/04/08:

2015/03/27:
    Adding new SMF type
    http://answers.eng.netapp.com/questions/7929/has-the-way-we-create-a-new-type-in-smf-changed.html

2015/03/22:
Converting Vser id to Vserver name
smdb_type_vserverid vsid = get_vserver();
std::string vserver_name;
err = vsid.lookup_name(vserver_name);


2015/03/11:
    Myself:
        We cannot create multiple volumes with the same JUNCTION PATH

2015/03/10:
    Saji:
        Check for SpinNp errors.

2015/02/09:
    Praveen:
        you have transfer epsilon to the next node  1:32 PM 
        do cluster show in test mode 
        
        otherwise rebooting master node will cause all nodes in the cluster to go out of quorum
2015/01/22:
    Sunny:
        Protoclient:
            Right now the requests are synchronous. So that one request gets sent; waits for response and then the next request will be sent;

            But we need to send asynchronous requests.

2015/01/15:
    Praveen:
        IOCTL: are used to tell in advance to the client about certain things. Eg, the capabilities that the client support; to say that client would be doing copy offload instead
        of normal copy

        PARENT CHILD TRUSTS

        Configure Vscan - Cliff Burt 846497

    Raghav:
        To trigger sendInterimResponse()
            Have to clients, one the same file on both. It would trigger an Oplock break and send an interim response.

2015/01/09:
    Praveen:
    cifs-domain-discovered-servers-reset
    there is no way to modify the security row table once we got it from the DC.

    Read about KRB conf file. It is a read only file.
    So only way is to do the change programatically. Kalpit added an RPC, that would
    get called when we do a discovered-servers-reset and update the security row.



2014/11/11:
    Praveen:
    In case of SMB1, a cifs session gets disconnected immediately after a session setup.
    SMB1 does not have durable handles. So the connection would get disconnected immediately

2014/11/07:
    Wes: Burt 803070
    is-signing-required NTLM

    NTLM challenge response will happen. But might not be always visible on the wire.
    Version of NTLM is decided based on the Length. If more than 24 bits then NTLMv2 is used. Else NTLM is used.
    Even we don't know the username and password. We would just get an encrypted message which we send it to the DC.
    DC has the password and it would verify and give us back the challenge response. That is how we authenticate.

    Nt4Ctx.cpp:
    bool          isNTLMv2          = (ntResponse.length() > 24);
    checkNtlmv1Response()

2014/10/31:
get dynamics imp does not store the value persistently in the db. It just saves it in the RDB but not in the flat file.
get dynamics imp gets called before get_imp(). 

So in a mixed cluster say we have fake open option and a capability associated with it. We set default value in dynamics_imp.
Say FS.0 has Fake open and SN.2 does not have.
In a mixed cluster, the CAPABILITY would be disabled. when you are trying to modify some other option, modify_imp() gets called, 
which would call the get_imp() to get the default values for other fileds which would call the dynamics_imp(). So fake open gets set. 
But in modify_imp() we have a capability check that does not allow us to modify the fake open and we FAIL. We fail trying to set 
a value to Fake Open option that is not supported

2014/10/30:
    Sunny:
    gbuf and mbuf. 
    gbuf is a wrapper of Mbuf in the way we need it. So we do ungbuf to get the original mbuf

    Input buffer list is used in SMB1 and chain is used in SMB2.


2014/10/29: Saji:
    Domains:
    cahona, wafinized; network exempt;

    Initially when ONTAP started, everything was single threaded, i.e. WAFL, CIFS, Network etc. All These can be run only in Serial and not in Parallel
    WAFL introduced AFFINITY as a means of their parallelism. Everything that can be wafinized can run in parallel.
    We used NETWORK CONTEXT as a way to achieve parallelism. So all Nblade code runs in Network Exempt domain.
    

2014/10/20:
    How to convert Vserver Id to Name
        pragadhe-clus-6::*> diag secd configuration query -node pragadhe-vsim6 -source-name vserverid-to-name
        debug smdb table sequential_identifier show -fields id,name
        debug smdb table vserver show -fields uuid,name

2014/10/15:
    In ZAPI we always return EINTERNALERROR.
    any modification failed error apart from (vserver not found) will be returned as EINTERNALERROR for ZAPIs

    In ZAPI for CIFS Share Properties as well as Other, we can use both '_' as well as '-'
    In 7 mode we have a mapping and the same behavior is getting carried to cmode; though not sure where the cmode mapping is done
2014/10/10:
    MGWD process supresses the BACKTRACE that comes in the mgwd log.
    Restarting the mgwd process would help in clearing it

2014/09/25:
Praveen:
    UPGRADE_RETRY: UPGRADE RETRY:
        Useful only when we are doing something in an RDB transaction and if we would fail. i.e If we are  doing a BATCH upgrade, then we might hold locks on transaction and there can be chances
        of failing becuase of rdb lock. In that case if we return a upgrade_retry error, they automatically retry would happen after sometime.
        If not using RDB transactions then we don't have to return this error

    upgradeCommit() and revertCommit() gets called only for MAJOR upgrade.

    dynamics_imp()
       We can have for db_iterator or manual table iterator. If we have for db iterator, then the values in DB WON"T get modified but NBLADE will see as if the DB table is modified. So this is useful
       when an upgrade happens between minor releases and we want to change something.

       The dynamics_imp() for manual table iterator - There are times, when want the value to get PSEUDO updated only in the Manula table for mhost and not needed for Nblade. So we do this. 

2014/09/19:
	NFS guys:
		1. Map a share that is at the ROOT of the volume
		2. Create a Volume as a Junction inside ROOT volume.
		   Say the root volume is 20MB and the New Volume "test" created inside the ROOT is 100MB.
		   ::*> vol create -volume t1 -aggregate paggr1 -size 100M -junction-path /test
		3. Now in the explorer, just doing a REFRESH is not showing the NEW VOLUME created insdie ROOT
		4. Remapping the share, show the NEW VOLUME as shortcut.
		5. Size of ROOT volume still shows 20MB and cannot copy a bigger file there
		6. But size of the OTHER volume is 100MB.

		We do this using reparse points

2014/09/18:
    Burt 853934:
        This issue will only be hit when there are some BYTE-RANGE locks with non zero pid

        PID is always handled in Lock Manager
        Only case this issue will be seen is CA shares

        Persistent handles are used in HyperV and SQL over SMB. From our knowledge, they DO NOT use Byte Range Locks

2014/0912:
    Burt 836756:
Until Sierranevada, ONTAP was using DATA LIF / MGMT LIF to communicate to external DNS/DC's. From FS.0 onwards, it's required to have atleast one DATA LIF per Vserver for this communication.
If there are two nodes and the DATA LIF is on node 1, you can still create/modify CIFS from node 2 because of VSUN.  But, for this to work both node1 and node2 needs to be in FS.0.

In your case, the node hosting the data lif was in SN.3, So when you run "cifs create" or "cifs modify" there are no data lifs for the Vserver to talk to.  VSUN cannot work, as node 1 is SN.3.
    
2014/09/04:
    Sunny:
        Nblade replay will happen only when DATA LIFs are up.
        Else there is no point to do replay, because we won't be needing the configurations at Runtime or any other run time values; as we won't be able to acess the node/share

        Mirror table resides in Nblade
        DB table resides in Mgmt gateway

2014/08/19:
    Praveen:
       Modifying on a DB iterator, directly modifies the RDB entries. If we do this, then we should take care of MCC scenario. The other node would not
       be aware of the values if we use the DB iterator.

       Instead if we use the manual iterator to modify the rdb values, then SIMILAR to replay happens and all nodes will have the updated value.

2014/08/18:
    Praveen:
        When reverting, we should clear all existing fields and during the upgrade we should set them to default values. 
        If we don't the rdb values before reverting will be preserved and on upgrade it would give the same values

        Also we have to ignoreAllValues() on the iterator. Else all the fields would get populated which would decrease the performance.
        Especially if we don't do for share_iterator, then we would even query the vserver table for something and it is time consuming

    Vedran:
        Exit_ON_ERROR vs ChkSmf()
            Exit_On_Error exits at the point itself. But ChkSmf goes to CatchErrors. Better to use exit on error if we want to RETURN at that point. 
            If USING CHK() style macro, everything that needs to be DECLARED should be done at the top.
                Chk()
                { if (false)
                    goto catch_errors;
                }
                string asf; ...

                After going to catch errors, WE CAN"T USE ASF. Not a good practice

upgrade_revert.h
static const u_int32_t getCurrentVersion() { return sierranevada_version_2; 

2014/08/12:
    Praveen:
        modify_imp() is called from  the CLI
        modify_api_imp() is called from ZAPI

2014/08/08:
    Praveen: cifs.trustedDomainLookup
        Like how win-unix name mapping works, If a user trys to log in from Unix using ROOT user, and if we have a unix-win name mapping as ROOT<->pcuser, we would consider ROOT as pcuser and proceed

        Similarly if we have truster domains, cifslab/root would be treated as ANY_OF_TRUSTED_DOMAINS/NAME_MAPPING_ENTRY

    Vedran: Code Review discussion
        About spanning a new thread.

        We used to have two functions, ONLINE_EVENT and OFFLINE_EVENT that would sent events when a node either joins back a quorum or goes out of quorum. We are not interested in the offline_event
        (other than for witness). During online_event, we would like to set various options/ capabilities. So we use this.

        Consider doing the entire work (enabling all the capabilities) as a circular queue of work. So we started create new threads for each work and gave to that thread. Intially we 
        had very few threads but over time, we got something like 15threads.
        And when these threads are doing some work, if a node rejoins the quorum then we span new threads again. So if a node happens to rejoin thrice, then we would end up with 45 threds.

        To prevent that we wrote a GUARD function that would check if the thread is already running, if so it would just rerun the thread instead of creating a new thread.

        BUT ALL THESE CAN BE ASYNCHRONOUS, so what we did was, we CREATED one function for ALL of CIFS things and put everything into that.

2014/06/24:
    Praveen: Manish Code Review:
        ignoreAllValues() and want_fieldname() comes hand in hand
        if we use something like itr->next(), it would generally fetch all the values that we might not need. So instead we would call ignoreAllValues and then just fetch the ones that we need.

    Burt 834922: 
        Having two CIFS Servers with same name on different clusters, then when the second CIFS server was created, it would have over written the first CIFS server's entry on the AD. So when we try to 
        connect to the second CIFS server, it would fail.
2014/06/19:
    Praveen/Raghav:
        CIFS Stop: when we do, what ultimately gets triggered in Nblade and how does it happen. i.e. from Mgwd gateway to Nblade

        Changes to RDB table, triggers Nblade Replay. Once Nblade replay happens we would be having the new values available in Nblade, which we can make use of
        nblade_config.cpp
        ConfigReplay.cpp

        nblade_replay.cc: This file is used for "diag nblade replay show" command
        We initially thought that status_admin should get replayed as it goes from UP to DOWN during CIFS Stop. But need not be. CIFS stop is just considered as removing that vserver itself.
        To trace CIFS Stop, try following deleteExportShare, delete Vserver in nblade code. It is the same sequence that happen when we do CIFS Stop as well

        Vserver_mirror_notify_imp()
        Every RDB table has a corrsponding Mirror table. 

        EXPORT Share:
            we have admin-share and non admin shares.
            cifs_share_iterator::is_admin_share()

        To monitor the log files,
        tail -f mgwd.log | cut -b 80- | grep nblade_replay

2014/05/28:
    Sunny:
        Transaction:
            We don't need to use a transaction when we are modifying just one entry in a table.

            In fake_open::updateServerState(), we are modifying multiple entries in the table. i.e. setting everything fake-open-option to true.
            So using a transaction.

            A transaction is only needed when we are modifying multiple entries at the same time or we want "all or nothing" behavior

    Vserver:
        https://wikid.netapp.com/w/Vserver    
        Vserver is a virtualized server. It spams across multiple nodes in a cluster and contains all the entities that are necessary to make the data available to the customer.
            - It contains the Authentication domain so that data in a vserver cannot be accessed from another vserver
            - Protocols to see the data
            - It contains all basic things like vol, aggr that would make data available to the user.

2014/05/27:
	Praveen:
		Aborting a child transaction aborts the parent transaction
	

CLUSTERED DOT	
	Scale Out vs Scale Up
        Scale Up: Increasing the scalability by adding disks to the same container
        Scal Out: By adding more containers
	Clustered DataOntap supports both NAS and SAN
		- many nodes can be put together to form a cluster
		- single file system can scale over multiple storage systems.
		- NAS from 2 - 24 nodes
		- SAN from 2 - 8 nodes
		- SAN supported only from 8.1
        - Move volumes in a way so that it is transparent to the namespace

        7 Mode:
            5 components:
            Network, Protocols, WAFL, RAID, Storage
            Network: Receives data from the client and delivers it to the physical RAM
            Protocols: Determines the protocol used to transfer data and then sends pertinent info onto WAFL
            WAFL: Receiver RAW data and places a copy into NVRAM
            RAID: WAFL sends the data to RAID, which calculates parity to protect the data
            Storage: RAID sends data and parity info to the storage module. The storage module physically performs the wirte to disk


		cDOT:
            Network + Protocols = Access Protocols <-> Interconnect <-> Storage (WAFL+RAID+Storage)


2014/05/22:
    Praveen:
        cifs_share_byname table is the manual table. NOT cifs_share table.
        This is something like a View, that would combine multiple tables

        Name mapping, replace any pattern to Root, will replace the default PCUSER to root
        WAFL always needs a Unix user. That is why we have default unix user. 

        Wireshark: (smb||smb2) && (ip.addr==....)

        NTLM 0.12 means SMB

2014/05/09:
    Burt 819904:
        Praveen: 
            net in modify - is NOT used to migrate lif from one node to another
                          - instead we should use net int migrate

            When reverting a two node cluster, when a node goes down all the lifs will be migrated to the node that is alive.
            After the second node comes up, the lifs won't go back. It will go back only in case of HA pair

        Branch Cache:
            A feature introduced by Windows. Something like a P2P.
            When a client wants to fetch some data from a server, if the same data is present with another client (client2), then instead of overloading the server, client1 can get the
            data from client2.
            Eg: When Bangalore clients needs data from SVL servers, instead ONE client in bangalore can have the data and other clients can use take the data from the client in 
            Bangalore instead of contacting the SVL server.
            In this case, client1 will compute a hash with the data got from client2 and a hash with the data got from the server. Only if these two are the same, the client will
            fetch the data from client2. 

    CIFS Listening Ports:
vs2              lif2:137                               UDP/cifs-nam
vs2              lif2:139                               TCP/cifs-srv
vs2              lif2:445                               TCP/cifs-srv
        
2014/04/18:
    Praveen Burt:
        http://burtweb-prd.eng.netapp.com/burt/burt-bin/start?burt-id=645565
        https://reviewboard.netapp.com/r/130026/diff/2/#index_header
        Rewind mechanism in SMB1 and SMB2
        Adding FIJI

        needs_fieldname()
    https://wikid.netapp.com/w/Simple_management_framework/Reference_Manual#needs_fieldname.28.29
    Burt : http://burtweb-prd.eng.netapp.com/burt/burt-bin/start?id=819038
    Burt : http://burtweb-prd.eng.netapp.com/burt/burt-bin/start?burt-id=607258
http://burtweb-prd.eng.netapp.com/burt/burt-bin/start?id=796004&fz=580&btn=edit
    diag secd configuration query -node praveenl-clus-4-01 -source-name vserverid-to-name


    Burt to go through:
    http://burtweb-prd.eng.netapp.com/burt/burt-bin/start?id=754558&fz=748&btn=edit

   Raghavc:
        Burt cli: burt, burt_google pragadhe | less

2014/04/11:
    Praveen:
        SMB timout: isTimedOut()
            We have various timeout values for various operations. If any operation does not complete in its allocated time, we would time out.
            eg: if the total times ,exceeds 40 secs, we would send a timeout to the client

            If we have not reached the timeout value, we keep retrying and during the retries, we would be 
2014/04/09:
    Raghav:
        Getting Global Config Lock before obtaining Vserver info
        CIFSGLOBALS_LOCK_SCOPE_FOR_READ
        If LOCK is not obtaining, and if nblade_replay happens at the same time, it fails.
        If we don't get, then there is a very rare possibility that someone trying to modify a vserver or add a lif or something in that small duration

        Streams:
            File1: stream1
                   stream2
                   etc
            We enumerate like, f1:s1, f1:s2 etc. Streams does not have all info like normal files. They don't have 8.3 names. We just leverage on the GenericReadDir and smiliar enumeration 
            code to enumerate streams.

2014/04/01:
    Praveen:
        How to perform ZAPI testing.
        ONTAPi takes node management IP. If we give the LIF IP, then can perform operations only for that LIF
        Only the admin has ONTAPi privileges. So we should log in as admin instead of diag
2014/03/31:
    Praveen:
        In SN, when a AD server is created, we do not create a CIFS row
        But in FS, we create a CIFS row.
        So if we have an AD server in SN and then upgrade it to FS we will face issue. Hence cameup with FSUpgradeCommit() by Praveen.
        Also for AD server, every time a new field is added, it has to be passed to secd if there is no cifs row. If there is a cifs row, the entire row can be passed

2014/03/28:
    Raghavc:
        If Long name is invalid, dBlade returns 8.3 names instead of long names. Hence to the windows client we show 8.3 names and not long names
2014/03/26:
    Mark:
        How bamm bamm works. Trade off between performance and taking snapshots
            Object files and source files are on the same volume. So can't take snapshots
        How to take backup of the p4 directory

    Qtree:
        - added features like assigning a security style
        - works in mixed mode

2014/03/25:
    Mark:
        How LOOKUP is done. In case of a LOOKUP we don't match 8.3 Names
        How LOCK is done in memory. Why it more time consuming.
        Should LOOKUP on 8.3 Names with OPTION set to OFF (don't search 8.3 names) match 8.3 names or should it not.
            If Matches and displays:
            
            If Match does not then:
                Trying to create a file won't let the user create as there is a file that matches the 8.3 name
                If a user tries to see the file, we won't show the file

        Windows, if 8.3 Names is off, won't even generate 8.3 names for Newly created files. But existing file can have 8.3 names.

    ACL: DACL vs SACL
        http://msdn.microsoft.com/en-us/library/windows/desktop/aa374872%28v=vs.85%29.aspx
        http://clintboessen.blogspot.com/2011/04/whats-difference-between-acl-ace-dacl.html

    Praveen:
        token manager stats - useful in some cases for Direct Copy

        PIT Copy vs Direct Copy
            If direct copy is enabled:
            Consider copying files between two shares. Both shares reside on the Same cluster. Normal copy would send the data to the client. Do the copy and again send the data back to the server.
            i.e /vol1/file1 /vol2/file1. Here Vol1 and Vol2 are on the same dblade/cluster.

            With Direct Copy, in this scenario, the copy will happen directly at the Dblade. So this will be faster. Based on remote dblade, different aggregate or same aggregate.

    Kalpit Burt 808091:
The CIFS server account was reused by someone else on the DOMAIN, i.e. someone else used the same cifs server name as used by this test.

There was still client authentication traffic coming into this box.  To authenticate clients, SecD would make LDAP and Kerberos connections to the Domain controller.
The TCP connections would be successful, but the actual application (LDAP) connection would fail.  The application connections were failing because of "out-of-sync machine account password".

This causes SecD to treat the server as "bad" and drop the TCP connection.  The server is treated as 'Bad' because no authentication can be performed using this server.

And this kept happening over a long period of time and at a high rate which filled up the firewall states.  Which in turn caused CRS/DSMF traffic to fail leading to vserver command to fail.

    manish6 Burt 812050:
        Capability Manager: <auto_disable> will not be executed if <howto_downgrade> is specified.


    Kalpit Burt 811860:
This is as a result the changes made in SecD for Nameservices project.

In SN.x (8.2x) releases, we were searching only for  uidnumber, gidnumber attributes and they MUST be present in the LDAP search response else we failed the search.  The packet trace confirms this:

frame 316 - LDAP query for sAMAccountName salesuser1 and requesting attributes: uidnumber, gidnumber

But in FS.x releases, to support user lookup via ldap from Libc, now we search for all the attributes.  Hence the atrributes in frame 1831 are the following : sAMAccountName, uidnumber, gidnumber, unixuserpassword, name, unixuserpassword, unixhomedirectory, loginshell

And we made these OPTIONAL because not all of the attributes are always present on the LDAP server.  And because we get back "sAMAccountName" from the LDAP server in case of FS.x (8.3) release, we consider the search as "successful".

I think making uidnumber and gidnumber as a MUST should fix this.  This would atleast match with SN.x behaviors.

Although, the fix would need to take care of configurations where one can set up fields in a way which would seem wrong but are valid configurations (servers will let you set up that way)


2014/03/24:
    Subin:
        Where the error logs in files like ng_readdir.c get printed.
            They get printed on the console and we have to enable waflng in Dblade prompt of the filer

2014/03/18:
    Praveen - 8.3 Names Burt
    Sunny:
        Shares - while enumerating the shares, acquire locks so that new shares won't get created simultaneously
        EG:
            http://opengrok-prd.eng.netapp.com/source/xref/dev/nblade/src/Protocols/Cifs/Rpc/SvrSvc.cpp#1034
            nblade/src/Protocols/Cifs/Rpc/SvrSvc.cpp::MarshalShareEnum()
        
        
2014/03/17:
    Burt 809716 - Fake Open Repository Vserver
        Praveen:
            Modifying an entry in Manual Table, calls modify_imp()
            Modifying an entry in RDB table, directly modifies in the flat file and does not call modify_imp()
        Rommel:
            How flex vol and infinite vols work.
            In case of flex groups, which cames as a solution for infinite vols,
                moved from Nblade to Dblade. 
                i.e. Instead of user -> Nblade -> various Dblade
                                user -> Nblade -> Dblade, Here Dblade will do the work

2014/03/13:
    Burt 808248 - QoS CIFS Timedout:
        Praveen:
            QoS - In NFS they have a separate flow control which can be used to limit the INPUT requests coming. We don't have such an option for CIFS. 
                  So if we have a QoS, it would take care of that. 
                  QoS would overall restrict the amount of workload going to DBLADE
                  For CIFS: we just add the extra one in the queue, sleep for 3 milli seconds and retry after that.
                  In this burt: there are 2 workloads : CIFS and NFS
                  If two workloads are present, the number of IOPS in this burt which is ~1000 is very less.

2014/03/10:
    Burt 237717 - 8.3 Names:
        Mark:
            How NBLADE to DBLADE requests goes.:
            file_ops.wiki: has the definition for all SPIN NP calls.
            When a client sends a request,
            NBLADE to DBLADE:
                The request can go either to Local DBLADE or REMOTE Dblade
                Goes from Transport Layer -> Network Layer
                The data gets formatted when it is sent on the wire
                SPINHI takes the wire formatted data and CONTRUCTS A WAFL message that can be used by the WAFL layer.

                WAFL reply reenters the SPINHI and 
                    marshalling of the respone happens.

                In case of Local DBLADE,
                    queues are sent to the NETWORK CONTEXT.
                    PostMan unmarshals these things.

2014/03/06:
    Burt 780969 - Home dir
        Sunny / Jim:
            - If a home dir share and a normal share exists with the same name, the normal share gets priority. That gets mapped first.
            - Path of the share , in case of a home directory, gets added to the search path.
                - We can give / in the share path. It would mean the base search path itself. 
                - If we give something like %w, then it would be translated into, /search_path/%w/

    Praveen:
         - Revert when adding a new feature in a DOT. release
         - No need to write any revert code. Always when a node image is modified or when a revert check is done, how to downgrade message gets called. So based on the message, as user would execute the
           howto_downgrade message, based on the message, the user will do a modification / removing the option.
           remove_imp() or modify_imp() should take care of this

         - If access denied error, when mapping a cifs share
            Check secd.log for secd_auth enabled

2014/03/04:
    Burt 780969 - Home dir
        Sunny:
            how home dir mappings work. 
            some information about tid and session id. 
            share pattern is deprecated

        - Kerberos vs NTLM
            serverfault.com/questions/254813/why-use-kerberos-instead-of-ntlm-in-iis
            Kerberos:
                requires client connectivity to an AD DC (tcp/udp 88) AND the server
        - local user vs domain user

2014/02/25:
    Burt 780969:
        From burts:
            Symlink:
                ln -s /abc/ wl1
            ** WideLink: 
                ln -s /abc  wl1
                https://wikid.netapp.com/w/Widelink_Step_By_Step_C-mode
                https://wikid.netapp.com/w/Widelinks
                https://library.netapp.com/ecmdocs/ECMM1278215/html/filesag/7multi53.htm
                http://www.ehow.com/info_12206306_difference-between-symlink-widelink.html


2014/02/24:
    Praveen:
        MCC:
            Cluster that is used for disaster recovery type. 
            Async DR and Synchronous DR - in case of sync, all nodes will always be on sync, so more overhead
                In case of async, the nodes will be in sync on periodic intervals
        Burt - Home dir:
            show-smb-attr
            7mode lock-status is same as locks show in cMode
                http://opengrok-prd.eng.netapp.com/source/xref/Rfullsteam/mgmtgateway/src/tables/client_locks.smf#26
2014/02/19:
    Jim - Burt 780969
        How to setup home dir and basic knowledge of homedirs

2014/02/12:
    Isabelle:
        1. Path of flat file of RDB
            /mroot/etc/cluster_config/rdb/Management
        2. have_fieldname()
            returns FALSE when there is NO ENTRY in the flat file
        3. dynamics_imp() does not modify the db table.
            But there might a some other call after that, which can potentially modify the db table.
2014/02/11:
    Mark:
        Sat with mark and found out the bug in Pattern Matching Code
    Isabelle:
        1. Reverting a node does not delete the table entries
        2. dynamics_imp doesn't write to the db
    Praveen:
        1. Effective Cluster Version
2014/02/07:
    Mark:
        8.3 Names:
            How 8.3 names get generated. During initial days, all Windows had was 8.3 names. Later they came up with support for long names.
            So this is a serious issue in windows when 8.3 names is very different from long name. A file can get deleted accidently
    Praveen and Kalpit:
        1. cifs_onlineEvent() vs cifs_capUpdateCallback()
            *  Why should we write code in cifs_capUpdateCallback() and not just in onlineEvent()?
            Online_Event() gets called, even when mgwd gets restarted.
            onlineevent gets called first and the updatecallback gets called. 
            capUpdateCallback() gets called whenever a new capability row gets added.
            onlineEvent() gets called everytime a node reboots.

            upgradeCommitRDB gets called only when the node is upgraded. But this is called for each node in the cluster.

        2. First use and Last use:
            When we enable a capability when the first vserver gets the capability and disable only when the last vserver removes the capability(), it is called as first and last.
        3. Minor Upgrade vs Major Upgrade:
            When we introduce some new feature in say 8.2.1 or 8.2.1 it will be considered only for minor upgrade. But for fake open suppor/ namespace caching, as I am adding the feature in 
            8.3, it will be for Major Upgrade. 
            Minor upgrade might not have capability management stuff
        4. Capability is NODE WIDE and NOT CLUSTER WIDE:
            so a capability can have different values for different nodes. But as CIFS is cluster wide, all cifs options / capabilities are same cluster wide.
        5. ECV:
            another way to do the capability check is making use of Effective Cluster Version.
        6. dynamics_imp()
            This does not write to the rdb. So there will a problem when nblade replay happens.
            We only write to rdb when we do a modify. 
            For most cifs stuff, we might have a mirror table and nblade replay might have to happen
            MIRROR TABLE:
                it can be seen using, debug smdb table cifs_option [TAB]
            So the code that we would write in dynamic_imp, when a node comes online, has to be written in online_event() and we should make sure that we write it in the RDB table.
            See cifs_security.cc:300 for example
        7. Upgrade/Revert:
            After an upgrade, just checking if upgrade is successful won't solve the issue. we should check the protocol testing, or at least do a 
            cifs listeners show and see if we are listening over the cifs ports.
        8. nblade replay:
            * Why won't nblade_replay won't be called or not be an issue for SN-FS???
    Praveen:
        cifs listeners, lease and home dir basic info 

2014/02/06:
    Isabelle:
        1. Transaction:
            How to make sure ALL OR NONE, ie. use transaction when make changes to smf table.
2014/02/05:
    Praveen:
        dynamics_imp(): Better understanding about SMF
    Mark:
         Pattern Matching Code:
            How Lookup is different from regular finding a name. WAFL has two segments (each some 64kblock)
            Manu: did a code change which determines if lookup needs to be done or just searching a name.
                  If lookup, it uses hashes, where each hash is the hash got from the file name. So just looking for a hash tells if file is present. 
2014/02/04:
	Burt 758378 - Fake Open Support
		Praveen:
			1. clearAllKeys() - in revertCheck is used only at certain places. 
				https://wikid.netapp.com/w/Simple_management_framework/Reference_Manual
				Useful when there are multiple keys. Especially when the key has been moved forward.
			2. cifs_server_option_iterator_default_imp() - does not have values for all the cifs options. Eg: Missing smb2enabled, smb3enabled, dac etc
				Always create_imp gets called and it calls the default imp.
				This gets called during CIFS Server creation. If a user does not provide any default value, then we take the value from default_imp. 
				so if we don't have a value in default_imp, we can do the same in create_imp. Set the value by checking the ONTAP Version etc
			3. App error like CIFS_ERROR _COPY_OFFLOAD_WITHOUT_SMB3
				These are define in message_catalogs/src/en/cifs_errors.et
		
		SAJI:
			1. Create_imp() - IS FAKE Open should be checked only against SMB2 or against SMB3 as well?
				Fake Open support exists only in SMB2 code path. 
				a. Check if Fake Open Code won't get called when SMB2 is disabled and SMB3 is enabled
                    SMB3 can be enabled only when SMB2 is enabled.
			2. If we disable SMB2, Fake Open should be disabled as well
			3. Repository Vserver:
				Used for CR (Content Repository).
                i.e for Namespace volumes. 
                In case of Namespace Volumes, where A HUGE DATA is spread across multiple volumes. And to user, it appears as if the data exists on the namespace(Abstracted higher level) volume.
                But internally the data would be stored in sevaral volumes which can be spread across multiple location.
                So when a request comes to namespace volume, Nblade would get the different internal volume numbers and give it back.
                Right now we don't support namespace volume so well. 

2014/02/03:
    Burt 633113 - Namespace Caching
        Praveen:
            1. Capability Manager:
                There is another table which contains the list of capabilities.
                pragadhe-clus-1::*> capability show -node pragadhe-clus-1-01 -capability cifs*

        Isabelle:
            1. (bool check) in revert_to.cc:
                This check = true, when we do a -check-only during revert process
            2. Capability Manager directly returns error to the user by checking the cap.xml
                It checks the version in cap.xml. If Auto-disable == FALSE, the it can not disable, so error is thrown to the user
                IF auto-disable == True, then during revert, it won't complain and disable the capability
                    * What if shares have the property set ????
                auto_enable: this means that the capability is not enabled by the programmer. There is some CLI command that needs to be executed by the administrator that enables the capability
                Eg: when the first cifs server sets search-short-names option
